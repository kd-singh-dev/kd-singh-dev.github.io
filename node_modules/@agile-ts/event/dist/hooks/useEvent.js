"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.useEvent = void 0;
const react_1 = __importDefault(require("react"));
const core_1 = require("@agile-ts/core");
const useIsomorphicLayoutEffect_1 = require("./useIsomorphicLayoutEffect");
function useEvent(event, callback, key, agileInstance) {
    const [, forceRender] = react_1.default.useReducer((s) => s + 1, 0);
    useIsomorphicLayoutEffect_1.useIsomorphicLayoutEffect(() => {
        const generatedKey = event.on(callback);
        if (!agileInstance)
            agileInstance = core_1.getAgileInstance(event);
        if (!agileInstance || !agileInstance.subController) {
            core_1.Agile.logger.error('Failed to subscribe Component with deps', event);
            return;
        }
        const subscriptionContainer = agileInstance.subController.subscribeWithSubsArray(() => {
            forceRender();
        }, [event.observer], { key });
        return () => {
            agileInstance === null || agileInstance === void 0 ? void 0 : agileInstance.subController.unsubscribe(subscriptionContainer);
            event.removeCallback(generatedKey);
        };
    }, []);
}
exports.useEvent = useEvent;
